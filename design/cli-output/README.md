# Voratiq CLI: Design and User Experience

This document outlines the user-facing design, action trees, and rationale for the Voratiq CLI.

## 1. Overall Design Approach

The CLI's design is guided by the principles in `docs/principles.md`: fast failures, thin command logic, and a single source of truth for workspace definitions. The user experience prioritizes clarity, consistency, and conciseness, providing the minimum information needed for a user to act.

Key elements of the design include:

- **Minimalism**: Each command provides a focused output, avoiding verbose logs unless an error occurs.
- **Discoverability**: Commands suggest the next logical action (e.g., `voratiq run` points to `voratiq review`).
- **Consistency**: Terminology, formatting, and artifact paths are consistent across all commands.
- **Repo-Relative Paths**: All file paths are relative to the repository root, making them easy to use with standard command-line tools.

## 2. Action Trees

### `voratiq init`

Initializes the Voratiq workspace in the current repository.

```
USER: voratiq init
  |
  +--> SYSTEM:
       - Verifies it's in a Git repository.
       - Creates `.voratiq/` directory and subdirectories (`runs`).
       - Creates `config.json` and `runs.jsonl`.
       - Prints a confirmation message listing created artifacts.
  |
  +--> (Error) SYSTEM:
       - If not a Git repository, prints an error and exits.
       - If workspace files already exist but are invalid, prints an error and exits.
```

### `voratiq run`

Executes agents against a spec file and records the results.

```
USER: voratiq run --path <spec> [--test-command <cmd>]
  |
  +--> SYSTEM:
       - Validates the workspace.
       - Verifies the spec file exists.
       - Generates a unique Run ID.
       - Prints the Run ID and spec path.
       - For each agent (`claude-code`, `codex`):
         - Prints the agent's name.
         - Sequentially runs the agent, captures artifacts (stdout, stderr, diff), and runs tests if specified.
         - Prints a summary of the agent's execution (status, changes, test results).
         - Prints paths to all captured artifacts.
       - After all agents complete, prints a confirmation message.
       - Suggests the `voratiq review` command with the new Run ID.
  |
  +--> (Error) SYSTEM:
       - If workspace is invalid, prints an error and exits.
       - If spec path is not found, prints an error and exits.
       - If an agent fails, records the failure, prints the error, and continues to the next agent.
```

### `voratiq review`

Allows the user to review the results of a run and choose a winning agent.

```
USER: voratiq review [<run-id>]
  |
  +--> SYSTEM:
       - Loads run records from `.voratiq/runs.jsonl`.
       - Selects the latest undecided run, or the run specified by `<run-id>`.
       - Prints a summary of the run, including agent status, test results, and changes.
       - Provides paths to the diff files for each agent.
       - Prompts the user to choose a winner (`claude-code`, `codex`, or `reject`).
  |
  +--> USER: Selects a winner (e.g., `claude-code`).
  |
  +--> SYSTEM:
       - Prompts the user for an optional note.
  |
  +--> USER: Enters a note (or leaves it blank).
  |
  +--> SYSTEM:
       - Records the decision (winner and note) in `.voratiq/runs.jsonl`.
       - Prints a confirmation message with the recorded decision.
       - Suggests the `voratiq apply` command to apply the winning patch.
  |
  +--> (Error) SYSTEM:
       - If no runs are available to review, prints a message and exits.
       - If the specified `<run-id>` is not found or already has a decision, prints an error and exits.
```

## 3. Design Rationale

### Tone

The tone is professional, direct, and concise, suitable for a developer-focused CLI tool. It avoids conversational filler and focuses on presenting information clearly.

### Terminology

The terminology is drawn directly from the project's documentation (`docs/` and `specs/`) to ensure consistency. Key terms include:

- **Run**: A single execution of agents against a spec.
- **Spec**: The input file describing the task for the agents.
- **Agent**: An AI model configured to generate code (`claude-code`, `codex`).
- **Artifacts**: The files generated by a run (logs, diffs, test results).
- **Workspace**: The `.voratiq/` directory containing all project data.

### Formatting

- **Indentation**: Two spaces are used for indentation to create a clear visual hierarchy.
- **Lists**: Bullet points (`-`) are used to present lists of information, such as artifacts or status updates.
- **Paths**: All file paths are presented relative to the repository root for ease of use.
- **Commands**: Suggested commands are shown in a format that can be easily copied and pasted.

## 4. Open Questions & Assumptions

### Assumptions

- **Sequential Execution**: The current design assumes that agents are run sequentially. The output reflects this by showing the progress of one agent at a time.
- **Stateless Commands**: Each command is treated as a stateless operation. For example, `voratiq review` does not depend on the state of the previous `voratiq run` command, other than the artifacts on disk.
- **Standard Terminal**: The output is designed for a standard, non-graphical terminal environment. It does not use colors or special characters, ensuring compatibility.

### Open Questions

- **Error Verbosity**: How much detail should be shown when an agent fails? The current design favors a concise failure message with a path to the full error log. Is this sufficient for debugging?
- **Diff Surfacing**: `voratiq review` currently just points to the diff file. Should it offer to display the diff directly in the terminal? For this MVP, linking to the file is simpler and aligns with the "thin command logic" principle.
- **Configuration**: How will users configure new agents or change default behaviors? The current specs mention a `config.json`, but the user-facing workflow for managing it is not yet defined.
